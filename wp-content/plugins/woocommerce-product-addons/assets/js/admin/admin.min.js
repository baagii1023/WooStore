jQuery(function(c){"use strict";var t={getAddonOptions:function(){var a={security:wc_pao_params.nonce.get_addon_options,action:"wc_pao_get_addon_options"};return c.ajax({type:"POST",data:a,url:wc_pao_params.ajax_url})},getAddonField:function(a,o){a={security:wc_pao_params.nonce.get_addon_field,action:"wc_pao_get_addon_field",field_type:a,addon:o};return c.ajax({type:"POST",data:a,url:wc_pao_params.ajax_url})},getBlockParams:function(){return{message:null,overlayCSS:{background:"#fff",opacity:.6}}},refresh:function(){var a=c(".wc-pao-addon").length,o=c("#product_addons_data select.addon_field_type");0<a?(c(".wc-pao-toolbar").addClass("wc-pao-has-addons"),c(".wc-pao-toolbar .wc-pao-import-addons").show(),c(".wc-pao-toolbar .wc-pao-export-addons").show(),c(".wc-pao-addons").addClass("wc-pao-has-addons"),c("#product_addons_data").removeClass("onboarding"),c(".addon_fields_container").removeClass("pao_boarding__addons"),c(".pao_boarding__addons__message").hide()):(c(".wc-pao-toolbar").removeClass("wc-pao-has-addons"),c(".wc-pao-addons").removeClass("wc-pao-has-addons"),c(".wc-pao-toolbar .wc-pao-import-addons").hide(),c(".wc-pao-toolbar .wc-pao-export-addons").hide(),c("#product_addons_data").addClass("onboarding"),c(".addon_fields_container").addClass("pao_boarding__addons"),c(".pao_boarding__addons__message").show()),o.find('option[value="add"]').prop("selected","selected"),o.blur(),c(document.body).trigger("init_tooltips")},expandAllFields:function(){var a=c("#product_addons_data .wc-pao-addon");setTimeout(function(){a.removeClass("closed").addClass("open"),a.find(".wc-pao-addon-content").show()},50)},closeAllFields:function(){var a=c("#product_addons_data .wc-pao-addon");setTimeout(function(){a.removeClass("open").addClass("closed"),a.find(".wc-pao-addon-content").hide()},50)},addonRowIndexes:function(){c(".wc-pao-addons .wc-pao-addon").each(function(a,o){c(".wc-pao-addon-position",o).val(parseInt(c(o).index(".wc-pao-addons .wc-pao-addon")))})},runFieldSortable:function(){c(".wc-pao-addons").sortable({items:".wc-pao-addon",cursor:"move",axis:"y",handle:".wc-pao-addon-sort-handle",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),t.addonRowIndexes()}})},runOptionSortable:function(){c(".wc-pao-addon-content-options-container").sortable({items:".wc-pao-addon-option-row",cursor:"move",axis:"y",handle:".wc-pao-addon-sort-handle",scrollSensitivity:40,helper:function(a,o){return o},start:function(a,o){o.item.css("border-style","dashed").css("border-width","1px").css("border-color","orange")},stop:function(a,o){o.item.removeAttr("style"),t.addonRowIndexes()}})},validateSettings:function(e="all"){c(".wc-pao-error-message").remove(),c(".updated").remove();var a,n=!0,s=!0,t=!1,i=!1;return c(".wc-pao-addons").find(".wc-pao-addon").each(function(a){var o,d;"all"!==e&&"addon_title"!==e||(0===(o=c(this).find(".wc-pao-addon-content-name").val().length)?(c(this).addClass("wc-pao-error").find(".wc-pao-addon-content-name").addClass("wc-pao-error"),t=!(s=n=!1)):255<o?(c(this).addClass("wc-pao-error").find(".wc-pao-addon-content-name").addClass("wc-pao-error"),i=!(s=n=!1)):(c(this).removeClass("wc-pao-error").find(".wc-pao-addon-content-name").removeClass("wc-pao-error"),c(this).find(".wc-pao-addon-header .woocommerce-help-tip.addons-max-length-title").hide())),"all"!==e&&"addon_option_title"!==e||(d=c(this).find(".product_addon_type").val(),c(this).find(".wc-pao-addon-option-row").each(function(){"multiple_choice"!==d&&"checkbox"!==d||0!==c(this).find(".wc-pao-addon-content-label input").val().length?c(this).find(".wc-pao-addon-content-label input").removeClass("wc-pao-error"):(c(this).find(".wc-pao-addon-content-label input").addClass("wc-pao-error"),c(this).parents(".wc-pao-addon").eq(0).addClass("wc-pao-error"),t=!(s=n=!1))})),s&&c(this).removeClass("wc-pao-error")}),!1===n&&(t?a=c('<div class="notice notice-error wc-pao-error-message"><p>'+wc_pao_params.i18n.required_fields+"</p></div>"):i&&(a=c('<div class="notice notice-error wc-pao-error-message"><p>'+wc_pao_params.i18n.max_title_length_exceeded+"</p></div>")),c(".wc-pao-addons").before(a),c("html, body").animate({scrollTop:c(".wc-pao-error-message").offset().top-200},600)),n},render:function(a,o){var d;switch(o.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").removeClass("full"),o.find(".wc-pao-addon-main-settings-1 .wc-pao-col2").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-label").addClass("full"),o.find(".wc-pao-addon-restrictions-select").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-2").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-required-setting").removeClass("hide").addClass("show"),a){case"multiple_choice":o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").removeClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("show").addClass("hide"),"images"===o.find(".wc-pao-addon-display-select").val()&&(o.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-label").removeClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_with_image));break;case"checkbox":o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-label").addClass("full"),o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide");break;case"custom_price":d=wc_pao_params.i18n.limit_price_range,o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-select").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show");break;case"input_multiplier":o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show"),d=wc_pao_params.i18n.limit_quantity_range;break;case"custom_text":d=wc_pao_params.i18n.limit_character_length,o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-2").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-select").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),"email"===o.find(".wc-pao-addon-restrictions-select").val()&&o.find(".wc-pao-addon-min-max").removeClass("show").addClass("hide");break;case"custom_textarea":d=wc_pao_params.i18n.limit_character_length,o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("hide").addClass("show");break;case"file_upload":o.find(".wc-pao-addon-adjust-price-container").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide");break;case"heading":o.find(".wc-pao-addon-required-setting").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-adjust-price-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-1 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-main-settings-1 .wc-pao-col2").removeClass("show").addClass("hide");break;default:o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-1").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1-2").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-main-settings-2 .wc-pao-col1").addClass("full"),o.find(".wc-pao-addon-content-option-rows").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-non-option-rows").removeClass("hide").addClass("show"),d=wc_pao_params.i18n.restrictions,o.find(".wc-pao-addon-restrictions-container").removeClass("show").addClass("hide")}o.find(".wc-pao-addon-restriction-name").html(d),t.update_remove_addon_option_buttons(o)},update_remove_addon_option_buttons:function(a){a=a.find(".wc-pao-remove-option");a.length<2?a.attr("disabled","disabled"):a.removeAttr("disabled")},delay:function(a,o){clearTimeout(0),setTimeout(a,o)},init:function(){var s=c("#product_addons_data"),a=c("<input>"),o=c("<input>");a.attr("type","hidden"),a.attr("name","pao_post_control_var"),a.val("1"),o.attr("type","hidden"),o.attr("name","pao_post_test_var"),o.val("1"),s.prepend(a),s.append(o),c(".post-type-product").on("click",'#publishing-action input[name="save"]',function(){return t.validateSettings("all")}),c(".product_page_addons").on("click",'input[type="submit"]',function(){return t.validateSettings("all")}),s.on("keyup",".wc-pao-addon-content-name",function(){var o=c(this);t.delay(function(){var a=o.val();o.closest(".wc-pao-addon").find(".wc-pao-addon-name").text(a)},300)}).on("blur",".wc-pao-addon-content-name",function(){t.validateSettings("addon_title")}).on("keyup",".wc-pao-addon-content-label input",function(){c(this).removeClass("wc-pao-error"),c(".wc-pao-error-message").remove()}).on("change","select.addon_field_type",function(){var e=c(".wc-pao-addons .wc-pao-addon").length,n=c(this),a=n.val(),o=t.getBlockParams();return s.block(o),setTimeout(function(){c.when(t.getAddonField(a)).then(function(a){a=(a=(a=a.html).replace(/{loop}/g,e)).replace(/closed/g,"open"),c(".wc-pao-addons").append(a);var a=c(".wc-pao-addons .wc-pao-addon").last(),o=n.val(),d=n.find('option[value="'+o+'"]').text(),d=(a.find(".product_addon_type").val(o),a.find(".wc-pao-addon-header .wc-pao-addon-type").html(d),t.render(o,a),t.refresh(),t.runOptionSortable(),c("select#product-type").val());c(".hide_if_"+d).hide(),c(".show_if_"+d).show(),s.unblock()})},250),!1}).on("change",".wc-pao-addon-display-select",function(){var a=c(this).val(),o=c(this).parents(".wc-pao-addon");"images"===a?(o.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-label").removeClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_with_image)):(o.find(".wc-pao-addon-content-image").removeClass("show").addClass("hide"),o.find(".wc-pao-addon-content-label").addClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_default))}).on("click","button.wc-pao-add-option",function(){var o=c(this).closest(".wc-pao-addon"),d=o.index(".wc-pao-addon"),e=c(this).parents(".wc-pao-addon-content-option-rows").find(".wc-pao-addon-content-options-container");return c.when(t.getAddonOptions()).then(function(a){a=(a=a.html).replace(/{loop}/g,d),c(a).appendTo(e),"images"===o.find(".wc-pao-addon-display-select").val()&&(o.find(".wc-pao-addon-content-image").removeClass("hide").addClass("show"),o.find(".wc-pao-addon-content-label").removeClass("full"),o.find(".wc-pao-addon-content-option-header").text(wc_pao_params.i18n.options_header_with_image)),t.update_remove_addon_option_buttons(o)}),!1}).on("click","a.wc-pao-remove-addon",function(a){return a.preventDefault(),c(this).closest(".wc-pao-addon").off(),c(".wc-pao-error-message").remove(),confirm(wc_pao_params.i18n.confirm_remove_addon)&&(a=c(this).closest(".wc-pao-addon"),c(a).find("input").val(""),c(a).remove()),c(".wc-pao-addons .wc-pao-addon").each(function(a,o){var d=a;c(this).find(".product_addon_position").val(d),c(this).find("select, input, textarea").prop("name",function(a,o){return o.replace(/\[[0-9]+\]/g,"["+d+"]")})}),t.refresh(),!1}).on("click",".wc-pao-remove-option",function(){var a=c(this).attr("disabled");return void 0!==a&&!1!==a||confirm(wc_pao_params.i18n.confirm_remove_option)&&(a=c(this).parents(".wc-pao-addon"),c(this).parents(".wc-pao-addon-option-row").remove(),(a=a.find(".wc-pao-remove-option")).length<2?a.attr("disabled","disabled"):a.removeAttr("disabled")),!1}).on("click",".wc-pao-expand-all",function(a){a.preventDefault(),t.expandAllFields()}).on("click",".wc-pao-close-all",function(a){a.preventDefault(),t.closeAllFields()}).on("click",".wc-pao-addon-description-enable",function(){c(this).is(":checked")?c(this).parents(".wc-pao-addons-secondary-settings").find(".wc-pao-addon-description").removeClass("hide").addClass("show"):c(this).parents(".wc-pao-addons-secondary-settings").find(".wc-pao-addon-description").removeClass("show").addClass("hide")}).on("change",".wc-pao-addon-option-price-type",function(){switch(c(this).val()){case"flat_fee":case"quantity_based":c(this).parents(".wc-pao-addon-content-price-type").removeClass("full").next(".wc-pao-addon-content-price").eq(0).removeClass("hide").addClass("show")}}).on("click",".wc-pao-addon-add-image",function(){var d=c(this).parent(),a=wp.media.frames.mediaFrame=wp.media({title:wc_pao_params.i18n.add_image_swatch,button:{text:wc_pao_params.i18n.add_image},library:{type:"image"},multiple:!1});a.on("select",function(){a.state().get("selection").map(function(a){var o;(a=a.toJSON()).id&&(o=(a.sizes.thumbnail||a).url,d.find(".wc-pao-addon-option-image-id").val(a.id),d.find(".wc-pao-addon-image-swatch img").prop("src",o),d.find(".wc-pao-addon-image-swatch").removeClass("hide").addClass("show"),d.find(".wc-pao-addon-add-image").removeClass("show").addClass("hide"),d.find(".dashicons-plus").removeClass("show").addClass("hide"))})}),a.open()}).on("click",".wc-pao-addon-image-swatch",function(a){a.preventDefault();a=c(this).parent();a.find(".wc-pao-addon-option-image-id").val(""),a.find(".wc-pao-addon-image-swatch img").prop("src",""),a.find(".wc-pao-addon-image-swatch").removeClass("show").addClass("hide"),a.find(".wc-pao-addon-add-image").removeClass("hide").addClass("show"),a.find(".dashicons-plus").removeClass("hide").addClass("show")}).on("click",".wc-pao-addon-restrictions",function(){c(this).is(":checked")?c(this).parents(".wc-pao-addon-restrictions-container").find(".wc-pao-addon-restrictions-settings").removeClass("hide").addClass("show"):c(this).parents(".wc-pao-addon-restrictions-container").find(".wc-pao-addon-restrictions-settings").removeClass("show").addClass("hide")}).on("change",".wc-pao-addon-restrictions-select",function(){var a=c(this).val(),o=c(this).parents(".wc-pao-addon-restrictions-settings");"email"===a?o.find(".wc-pao-addon-min-max").removeClass("show").addClass("hide"):o.find(".wc-pao-addon-min-max").removeClass("hide").addClass("show")}).on("click",".wc-pao-addon-id",function(){return!1}).on("click",".wc-pao-addon-adjust-price",function(){c(this).is(":checked")?c(this).parents(".wc-pao-addon-adjust-price-container").find(".wc-pao-addon-adjust-price-settings").removeClass("hide").addClass("show"):c(this).parents(".wc-pao-addon-adjust-price-container").find(".wc-pao-addon-adjust-price-settings").removeClass("show").addClass("hide")}),s.find(".wc-pao-addon").each(function(){var a=c(this).find(".product_addon_type").val();t.render(a,c(this))}),t.refresh(),s.on("click",".wc-pao-export-addons",function(){var a=s.find(".product_addons_export_string").val(),o=c("<input>");return c("body").append(o),o.val(a).select(),document.execCommand("copy"),o.remove(),alert(wc_pao_params.i18n.addons_exported),!1}),s.on("click",".wc-pao-import-addons",function(a){a.preventDefault(),c(this).blur();var o,d,a=window.prompt(wc_pao_params.i18n.import_addons_prompt);if(!a)return!1;d="undefined"!=typeof woocommerce_admin_meta_boxes&&woocommerce_admin_meta_boxes.post_id?(o=woocommerce_admin_meta_boxes.post_id,!1):(o=new URLSearchParams(window.location.search).get("edit"),!0);a={security:wc_pao_params.nonce.import_addons,action:"wc_pao_import_addons",import_product_addon:a,post_id:o,is_global:d};c.post(wc_pao_params.ajax_url,a,function(a){var e,o;a.success&&!0===a.success?(e=c("select#product-type").val(),o=t.getBlockParams(),s.block(o),alert(a.data.message),setTimeout(function(){c.each(a.data.addons,function(a,o){var d=o.type;c.when(t.getAddonField(d,o)).then(function(a){var a=a.html,o=c(".wc-pao-addons .wc-pao-addon").length,o=(a=a.replace(/{loop}/g,o),c(".wc-pao-addons").append(a),c(".wc-pao-addons .wc-pao-addon").last()),a=c("select.addon_field_type").find('option[value="'+d+'"]').text();o.find(".product_addon_type").val(d),o.find(".wc-pao-addon-header .wc-pao-addon-type").html(a),t.render(d,o),t.refresh(),t.runOptionSortable(),c(".hide_if_"+e).hide(),c(".show_if_"+e).show()})}),s.unblock(o),setTimeout(function(){var a=c(".wc-pao-addon-header:last");c("html, body").animate({scrollTop:a.offset().top-200},1e3)},1e3)},1e3)):a.data.message.length&&alert(a.data.message)})}),t.runFieldSortable(),t.runOptionSortable(),c(".global-addons-form .wc-pao-addon").each(function(){c(this).hasClass("closed")&&c(this).find(".wc-pao-addon-content").hide()}),c(".global-addons-form .wc-pao-addon-header").on("click",function(){var a=c(this).closest(".wc-pao-addon"),o=a.find(".wc-pao-addon-content");setTimeout(function(){a.toggleClass("closed").toggleClass("open"),o.stop().slideToggle()},50)}),c("#addons-table #doaction").on("click",function(a){if("delete"===c("#bulk-action-selector-top").val()&&!window.confirm(wc_pao_params.i18n.delete_addons_warning))return a.preventDefault(),!1}),c("#addons-table #doaction2").on("click",function(a){if("delete"===c("#bulk-action-selector-bottom").val()&&!window.confirm(wc_pao_params.i18n.delete_addons_warning))return a.preventDefault(),!1}),1<c(".wc-pao-addons .wc-pao-addon").length&&c(".wc-pao-toolbar").show(),c('[name*="addon_wc_booking_person_qty_multiplier"]').on("change",function(){var a=c(this).attr("name"),o=c(this).is(":checked");c('[name*="'+a+'"]').prop("checked",o)})}};t.init()});